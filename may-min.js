(function(a){var e=function(b,d){if(e.defined(b))throw b+" defined";var c=d||eval(b);a[b]=c;c=e.__variables__;-1==c.indexOf(b)&&c.push(b)};e.defined=function(b){return a.hasOwnProperty?a.hasOwnProperty(b):"undefined"!==typeof a[b]};Object.defineProperty(e,"__variables__",{value:[],writable:!0});e.del=function(b){var e=this.__variables__.indexOf(b);if(0<=e){var c=this.__variables__;this.__variables__=c.slice(0,e).concat(c.slice(e+1))}a[b]=null;delete a[b]};e.list=function(){return[].concat(this.__variables__)};
"undefined"==typeof console&&(console={},"info log error debug warn trace dir".split(" ").forEach(function(){console.name=function(){}}));e("Mayjs",{VERSION:"0.5",$global:e,$run:function(b){return 1==arguments.length?b():b.apply(this,Array.prototype.slice.call(arguments,1))},HOST:a,$dsl:function(b){var b=b||this,a="_temp"+Date.now();eval(a+"={value: {}}");eval(a).value=b;return"var "+Object.keys(b).filter(function(a){return b.hasOwnProperty(a)&&"function"==typeof b[a]}).map(function(b){return b+"="+
a+".value['"+b+"']"}).join(",")+"; delete "+a}})})(this);
Mayjs.$run(function(a){a.util={forEach:function(a,b){for(var d in a)if(a.hasOwnProperty(d)&&!/^_/.test(d)&&!1===b(d,a[d]))break},toObject:function(a){var b=typeof a,d=a;-1==["object","function"].indexOf(b)&&(d=new (eval(b.charAt(0).toUpperCase()+b.slice(1)))(a));return d},parseParamNames:function(a){return(a=a.toString().match(/.*?\((.*)?\)/))&&a[1]?a[1].split(","):[]},fn:function(){return arguments.callee.caller.apply(this,arguments)},parseArray:function(a){return Array.prototype.slice.call(a,0)},
trace:function(a,b,d){for(;a;){if(!1===d(a))return!1;a=a[b]}return!0},mix:function(a,b,d){if(!b)return a;var c;if(d&&0<d.length)for(c in b)-1==d.indexOf(c)&&(a[c]=b[c]);else for(c in b)a[c]=b[c];return a},"enum":function(a){if("object"==typeof a)return arguments[0];for(var b={},d=0,c=arguments.length;d<c;d++)b[arguments[d]]={};return b},clone:function(a,b){var d={},c;for(c in a)d[c]=b?$clone(a[c]):a[c];return d},methodize:function(a,b,d){var c=Array.prototype.slice;return function(){var f=b||this,
f=[d?d(f):f].concat(c.call(arguments,0));return a.apply(null,f)}},overwrite:function(e,b,d){var c=e[b].bind(e);e[b]=function(){var b=[c].concat(a.util.parseArray(arguments));return d.apply(e,b)}},merge:function(a,b,d,c){for(var f={},h=null,g,i=0,k=arguments.length;i<k;i++)for(g in h=arguments[i],h)f[g]=h[g];return f}}},Mayjs);
Mayjs.$run(function(a){var e=function(a){/^__.*__$/.test(a)||(a="__"+a+"__");return a};a.meta={set:function(a,d,c,f){Object.defineProperty(a,e(d),{value:c,writable:!0!==f})},get:function(a,d){return a[e(d)]},has:function(a,d){return a.hasOwnProperty(e(d))}}},Mayjs);
Mayjs.$run(function(a){function e(a,c){var f=[];if(d(Array,a))if(c)for(var e=0,g=c.length;e<g;e++)f.push({name:c[e],type:a[e]});else a.forEach(function(a){h.forEach(a,function(a,c){f.push({name:a,type:c});return!1})});else f.push({name:c[0],type:b(a)});return f}function b(a,c){if(c){if(!g.isPrototypeOf(c))throw"Parameter base is not an Interface";interface_=Object.create(c)}else interface_=Object.create(g);h.mix(interface_,a);return interface_}function d(a,b){if(null===a)return null===b;if(void 0===
a)return void 0===b;var f=!1;switch(typeof a){case "string":f=typeof b==a;break;case "object":f=g.isPrototypeOf(a)?c(a,b):a.isPrototypeOf(b);break;case "function":f=(f=a.prototype)?f.isPrototypeOf(b):b instanceof a}return f}function c(a,c){if(f.has(c,"interfaces")&&-1!=f.get(c,"interfaces").indexOf(a))return!0;for(var b in a)if(!/^__.*__$/.test(b))if(d(Array,a[b])){if(!d("function",c[b]))return!1}else if(!d(a[b],c[b]))return!1;return!0}var f=a.meta,h=a.util,g={};a.$interface=b;a.$implement=function(a,
b){f.has(b,"interfaces")||f.set(b,"interfaces",[]);var h=f.get(b,"interfaces");if(-1==h.indexOf(a)){if(!c(a,b))throw"Not support interface";Object.keys(a).forEach(function(c){d(Array,a[c])&&f.set(b[c],"param_types",e(a[c]))});h.push(a)}};a.$support=c;a.$is=d;a.$checkParams=function(){for(var a=arguments.callee.caller,c=a.arguments,a=0===arguments.length?f.get(a,"param_types"):e(h.parseArray(arguments),h.parseParamNames(a)),b,g=0,j=c.length;g<j;g++){b=a[g].type;if(null===b)break;if(!d(b,c[g]))return!1}return!0};
a.util.def=function(a,c){f.set(c,"param_types",e(a,h.parseParamNames(c)));return c};a.Interface=g},Mayjs);
Mayjs.$run(function(a){var e=a.meta,b=a.util;a.$module=function(a){return a};a.$include=function(d,c,f){var f=b.merge({methodize:!1,context:null,methodizeTo:null,alias:null},f),h=f.methodize;b.forEach(d,function(a,d){"onIncluded"!=a&&(c[f.alias&&f.alias[a]?f.alias[a]:a]=h&&"function"==typeof d?b.methodize(d,f.context,f.methodizeTo):d)});e.has("interfaces")&&e.get("interfaces").forEach(function(b){a.$implement(b,c)});d.onIncluded&&d.onIncluded.call(c,f.context||c)}},Mayjs);
Mayjs.$run(function(a){function e(a,c){var f=Object.create(a),d;Object.__proto__?d=function(){var a=d.prototype.initialize;a&&a.apply(this,arguments)}:(b.set(f,"proto",a,!0),d=function(){this.__proto__=f;var a=d.prototype.initialize;a&&a.apply(this,arguments)});if(!d.extend){var e=arguments.callee;d.extend=function(a){return e(this.prototype,a)}}for(var l in c){var j=c[l];"function"==typeof j&&b.set(j,"name",l);f[l]=j}b.set(f,"interfaces",[]);d.prototype=f;return d}var b=a.meta,d=a.util,c=a.$interface({initialize:[],
base:[],__interfaces__:Array}),f=e(Object.prototype,{initialize:function(){b.set(this,"interfaces",[])},_callerOwner:function(a,c){var f=null;if(c){if(this.__proto__[c]==a)return this.__proto__;d.trace(this,"__proto__",function(b){if(b.hasOwnProperty(c)&&b[c]==a)return f=b,!1})}else d.trace(this,"__proto__",function(c){Object.keys(c).forEach(function(d){if(c[d]==a)return f=c,b.set(a,"name",d),!1})});return f},base:function(){var a=arguments.callee.caller,c=a.name||b.get(a,"name"),f=this._callerOwner(a,
c);c||(c=b.get(a,"name"));c=(a=f?b.get(f,"proto"):null)?a[c]:null;if("function"==typeof c)return c.apply(this,arguments)}});a.$implement(c,f.prototype);f.extend=function(a){var c=e(this.prototype,a);a.initialize||(c.prototype.initialize=function(){this.base()});return c};a.$extend=e;a.Base=f;a.IBase=c;a.$class=function(a){return f.extend(a)};a.$obj=function(a){var c=new f;d.mix(c,a);return c}},Mayjs);
Mayjs.$run(function(a){function e(c){var c=b.toObject(c),f=arguments.callee.findWrappersByObj(c);if(0===f.length)return c;var d={};f.forEach(function(f){a.$include(f.module,d,b.merge({context:c},f.includeOption))});return d}var b=a.util,d=a.meta;d.set(e,"map",[]);b.mix(e,{findWrappersByType:function(a){var b=d.get(e,"map").filter(function(b){return b.type==a});return 0===b.length?[]:b[0].modules},findWrappersByPrototype:function(a){for(var b=[],h;a&&!(b=b.concat(this.findWrappersByType(a)),d.has(a,
"interfaces")&&d.get(a,"interfaces").forEach(function(a){b=b.concat(e.findWrappersByType(a))}),h=a,a=h.__proto__||(h.constructor?h.constructor.prototype:null),a==h););return b},findWrappersByObj:function(a){if(null===a)return[];var b=[],h=typeof a;"object"==h||"function"==h?(b=b.concat(e.findWrappersByPrototype(a.__proto__||a.constructor.prototype)),d.has(a,"interfaces")&&d.get(a,"interfaces").forEach(function(a){b=b.concat(e.findWrappersByType(a))})):b=b.concat(e.findWrappersByType(h));return b},
exists:function(a,b){return 0<d.get(e,"map").filter(function(b){return b.type==a}).filter(function(a){return a.module==b}).length},regist:function(a,b,e){if(a!=Function.prototype&&("function"==typeof a&&(a=a.prototype),a!=Function.prototype&&(!a||-1==["string","object"].indexOf(typeof a))))return;if("object"==typeof b){var g=d.get(this,"map"),i=g.filter(function(b){return b.type==a}),e={module:b,includeOption:e};0===i.length?(i={type:a,modules:[e]},g.push(i)):0===i[0].modules.filter(function(a){return a.module==
b}).length&&i[0].modules.push(e);return this}}});a.$=e;a.$$=function(c){var c=b.toObject(c),d=e.findWrappersByObj(c);if(0===d.length)return c;d.forEach(function(b){a.$include(b.module,c,b.includeOption)});return c}},Mayjs);
Mayjs.$run(function(a){function e(c,d){for(var e=c||arguments.callee.caller,g=b.get(e,"param_types"),d=d||e.arguments,i=0,k=d.length;i<k;i++){e=g[i].type;if(null===e)break;if(!a.$is(e,d[i]))return!1}return!0}var b=a.meta,d=a.util;a.$overload=function(a,f){var h=["function"==typeof a?a:d.def(paramsTypes,f)],g=function(){var a=arguments,c;a:{c=a;var d=c.length,f=function(a){return b.get(a,"param_types")},g=h.filter(function(a){return f(a).length>=d});if(1>=g.length)c=g[0];else{for(var g=g.sort(function(a,
b){return f(a).length-f(b).length}),m;m=g.shift();)if(e(m,c)){c=m;break a}c=void 0}}if(c)return c.apply(this,a)};g.overload=function(a,b){h.push("function"==typeof a?a:d.def(a,b));return this};return g}},Mayjs);
Mayjs.$run(function(a){var e=a.util;a.dsl={$:a.$,$$:a.$$,$checkParams:a.$checkParams,$class:a.$class,$def:e.def,$enum:e["enum"],$fn:e.fn,$global:a.$global,$interface:a.$interface,$module:a.$module,$run:a.$run,$obj:a.$obj,$is:a.$is,$implement:a.$implement,$support:a.$support,$dsl:a.$dsl};a.DSL=a.$dsl(a.dsl);a.MFunction=a.$module({overload:function(b,d,c){b=a.$overload(b);b.overload(d,c);return b},paramNames:function(a){return e.parseParamNames(a)},methodize:e.methodize});a.MObject=a.$module({trace:e.trace,
clone:e.clone,merge:e.merge,mix:e.mix,meta:a.meta.get,setMeta:a.meta.set,hasMeta:a.meta.has,forEach:e.forEach,include:function(b,d,c){return a.$include(d,b,c)},overwrite:e.overwrite});a.init=function(b){b=a.util.merge({injectPrototype:!0},b);b.injectPrototype?(a.$include(a.MObject,Object.prototype,{methodize:!0,context:null}),Object.keys(a.MObject).forEach(function(b){a.HOST[b]=void 0}),a.$include(a.MFunction,Function.prototype,{methodize:!0,context:null})):(a.$include(a.MObject,a.Base.prototype,
{methodize:!0}),a.$.regist(Object,a.MObject,{methodize:!0}),a.$.regist(Function,a.MFunction,{methodize:!0}))}},Mayjs);
