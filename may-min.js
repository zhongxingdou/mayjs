(function(a){var c=function(b,f){if(c.defined(b))throw b+" defined";var e=f||eval(b);a[b]=e;e=c.__variables__;-1==e.indexOf(b)&&e.push(b)};c.defined=function(b){return a.hasOwnProperty?a.hasOwnProperty(b):"undefined"!==typeof a[b]};Object.defineProperty(c,"__variables__",{value:[],writable:!0});c.del=function(b){var c=this.__variables__.indexOf(b);if(0<=c){var e=this.__variables__;this.__variables__=e.slice(0,c)+e.slice(c+1)}a[b]=null;delete a[b]};c.list=function(){return[].concat(this.__variables__)};
"undefined"==typeof console&&(console={},"info log error debug warn trace dir".split(" ").forEach(function(){console.name=function(){}}));c("Mayjs",{VERSION:0.5,$global:c,$run:function(a){return 1==arguments.length?a():a.apply(this,Array.prototype.slice.call(arguments,1))},HOST:a,$dsl:function(a){var a=a||this,c="_temp"+Date.now();eval(c+"={value: {}}");eval(c).value=a;return"var "+Object.keys(a).filter(function(c){return a.hasOwnProperty(c)&&"function"==typeof a[c]}).map(function(a){return a+"="+
c+".value['"+a+"']"}).join(",")+"; delete "+c}})})(this);
Mayjs.util=Mayjs.$run(function(){return{forEach:function(a,c){for(var b in a)if(a.hasOwnProperty(b)&&!/^_/.test(b)&&!1===c(b,a[b]))break},toObject:function(a){var c=typeof a,b=a;-1==["object","function"].indexOf(c)&&(b=new (eval(c.charAt(0).toUpperCase()+c.slice(1)))(a));return b},parseParamNames:function(a){return(a=a.toString().match(/.*?\((.*)?\)/))&&a[1]?a[1].split(","):[]},fn:function(){return arguments.callee.caller.apply(this,arguments)},parseArray:function(a){return Array.prototype.slice.call(a,
0)},trace:function(a,c,b){for(;a;){if(!1===b(a))return!1;a=a[c]}return!0},mix:function(a,c,b){if(!c)return a;var f;if(b&&0<b.length)for(f in c)-1==b.indexOf(f)&&(a[f]=c[f]);else for(f in c)a[f]=c[f];return a},"enum":function(a){if("object"==typeof a)return arguments[0];for(var c={},b=0,f=arguments.length;b<f;b++)c[arguments[b]]={};return c},clone:function(a,c){var b={},f;for(f in a)b[f]=c?$clone(a[f]):a[f];return b},methodize:function(a,c,b){var f=Array.prototype.slice;return function(){var e=c||
this,e=[b?b(e):e].concat(f.call(arguments,0));return a.apply(null,e)}},merge:function(a,c,b,f){for(var e={},d=null,h,g=0,i=arguments.length;g<i;g++)for(h in d=arguments[g],d)e[h]=d[h];return e}}},Mayjs);Mayjs.meta=Mayjs.$run(function(){var a=function(a){/^__.*__$/.test(a)||(a="__"+a+"__");return a};return{set:function(c,b,f,e){Object.defineProperty(c,a(b),{value:f,writable:!0!==e})},get:function(c,b){return c[a(b)]},has:function(c,b){return c.hasOwnProperty(a(b))}}});
Mayjs.$run(function(a){function c(a,c){var e=[];if(f(Array,a)){var h=a.length,d;if(c)for(d=0;d<h;d++)e.push({name:c[d],type:a[d]});else for(d=0;d<h;d+=2)e.push({name:a[d],type:a[d+1]})}else e.push({name:c[0],type:b(a)});return e}function b(a,b){if(b){if(!g.isPrototypeOf(b))throw"Parameter base is not an Interface";interface_=Object.create(b)}else interface_=Object.create(g);h.mix(interface_,a);return interface_}function f(a,b){if(null===a)return null===b;if(void 0===a)return void 0===b;var c=!1;switch(typeof a){case "string":c=
typeof b==a;break;case "object":c=g.isPrototypeOf(a)?e(a,b):a.isPrototypeOf(b);break;case "function":c=(c=a.prototype)?c.isPrototypeOf(b):b instanceof a}return c}function e(a,b){if(d.has(b,"interfaces")&&-1!=d.get(b,"interfaces").indexOf(a))return!0;for(var c in a)if(!/^__.*__$/.test(c))if(f(Array,a[c])){if(!f("function",b[c]))return!1}else if(!f(a[c],b[c]))return!1;return!0}var d=a.meta,h=a.util,g={};a.$interface=b;a.$implement=function(a,b){d.has(b,"interfaces")||d.set(b,"interfaces",[]);var h=
d.get(b,"interfaces");if(-1==h.indexOf(a)){if(!e(a,b))throw"Not support interface";Object.keys(a).forEach(function(e){f(Array,a[e])&&d.set(b[e],"param_types",c(a[e]))});h.push(a)}};a.$support=e;a.$is=f;a.$checkParams=function(){for(var a=arguments.callee.caller,b=a.arguments,a=0===arguments.length?d.get(a,"param_types"):c(h.parseArray(arguments),h.parseParamNames(a)),e,g=0,j=b.length;g<j;g++){e=a[g].type;if(null===e)break;if(!f(e,b[g]))return!1}return!0};a.util.def=function(a,b){d.set(b,"param_types",
c(a,h.parseParamNames(b)));return b};a.Interface=g},Mayjs);
Mayjs.$run(function(a){var c=a.meta,b=a.util;a.$module=function(a){return a};a.$include=function(f,e,d){var d=b.merge({methodize:!1,context:null,methodizeTo:null,alias:null},d),h=d.methodize;b.forEach(f,function(a,c){"onIncluded"!=a&&(e[d.alias&&d.alias[a]?d.alias[a]:a]=h&&"function"==typeof c?b.methodize(c,d.context,d.methodizeTo):c)});c.has("interfaces")&&c.get("interfaces").forEach(function(b){a.$implement(b,e)});f.onIncluded&&f.onIncluded.call(e,d.context)}},Mayjs);
Mayjs.$run(function(a){function c(a,c){var e=Object.create(a),d;Object.__proto__?d=function(){var a=d.prototype.initialize;a&&a.apply(this,arguments)}:(b.set(e,"proto",a,!0),d=function(){this.__proto__=e;var a=d.prototype.initialize;a&&a.apply(this,arguments)});if(!d.extend){var f=arguments.callee;d.extend=function(a){return f(this.prototype,a)}}for(var k in c){var j=c[k];"function"==typeof j&&b.set(j,"name",k);e[k]=j}b.set(e,"interfaces",[]);d.prototype=e;return d}var b=a.meta,f=a.util,e=a.$interface({initialize:[],
base:[],__interfaces__:Array}),d=c(Object.prototype,{initialize:function(){b.set(this,"interfaces",[])},_callerOwner:function(a,c){var e=null;if(c){if(this.__proto__[c]==a)return this.__proto__;f.trace(this,"__proto__",function(b){if(b.hasOwnProperty(c)&&b[c]==a)return e=b,!1})}else f.trace(this,"__proto__",function(c){Object.keys(c).forEach(function(d){if(c[d]==a)return e=c,b.set(a,"name",d),!1})});return e},base:function(){var a=arguments.callee.caller,c=a.name||b.get(a,"name"),e=this._callerOwner(a,
c);c||(c=b.get(a,"name"));c=(a=e?b.get(e,"proto"):null)?a[c]:null;if("function"==typeof c)return c.apply(this,arguments)}});a.$implement(e,d.prototype);d.extend=function(a){var b=c(this.prototype,a);a.initialize||(b.prototype.initialize=function(){this.base()});return b};a.$extend=c;a.Base=d;a.IBase=e;a.$class=function(a){return d.extend(a)};a.$obj=function(a){var b=new d;f.mix(b,a);return b}},Mayjs);
Mayjs.$run(function(a){function c(c){var c=b.toObject(c),d=arguments.callee.findWrappersByObj(c);if(0===d.length)return c;var f={};d.forEach(function(d){a.$include(d.module,f,b.merge({context:c},d.includeOption))});return f}var b=a.util,f=a.meta;f.set(c,"map",[]);b.mix(c,{findWrappersByType:function(a){var b=f.get(c,"map").filter(function(b){return b.type==a});return 0===b.length?[]:b[0].modules},findWrappersByPrototype:function(a){for(var b=[],c;a&&!(b=b.concat(this.findWrappersByType(a)),c=a,a=
c.__proto__||(c.constructor?c.constructor.prototype:null),a==c););return b},findWrappersByObj:function(a){if(null===a)return[];var b=[],h=typeof a;"object"==h||"function"==h?(b=b.concat(c.findWrappersByPrototype(a.__proto__||a.constructor.prototype)),f.has(a,"interfaces")&&Maysj.meta.get(a,"interfaces").forEach(function(a){b=b.concat(c.findWrappersByType(a))})):b=b.concat(c.findWrappersByType(h));return b},exists:function(a,b){return 0<f.get(c,"map").filter(function(b){return b.type==a}).filter(function(a){return a.module==
b}).length},regist:function(a,b,c){if(a!=Function.prototype&&("function"==typeof a&&(a=a.prototype),a!=Function.prototype&&(!a||-1==["string","object"].indexOf(typeof a))))return;if("object"==typeof b){var g=f.get(this,"map"),i=g.filter(function(b){return b.type==a}),c={module:b,includeOption:c};0===i.length?(i={type:a,modules:[c]},g.push(i)):0===i.modules.filter(function(a){return a.module==b}).length&&i.modules.push(c);return this}}});a.$=c;a.$$=function(e){var e=b.toObject(e),d=c.findWrappersByObj(e);
if(0===d.length)return e;d.forEach(function(b){a.$include(b.module,e,b.includeOption)});return e}},Mayjs);
Mayjs.$run(function(a){function c(c,d){for(var f=c||arguments.callee.caller,g=b.get(f,"param_types"),d=d||f.arguments,i=0,m=d.length;i<m;i++){f=g[i].type;if(null===f)break;if(!a.$is(f,d[i]))return!1}return!0}var b=a.meta,f=a.util;a.$overload=function(a,d){var h=["function"==typeof a?a:f.def(paramsTypes,d)],g=function(){var a=arguments,f;a:{f=a;var d=f.length,e=function(a){return b.get(a,"param_types")},g=h.filter(function(a){return e(a).length>=d});if(1>=g.length)f=g[0];else{for(var g=g.sort(function(a,
b){return e(a).length-e(b).length}),l;l=g.shift();)if(c(l,f)){f=l;break a}f=void 0}}if(f)return f.apply(this,a)};g.overload=function(a,b){h.push("function"==typeof a?a:f.def(a,b));return this};return g}},Mayjs);
Mayjs.$run(function(a){var c=a.util;a.dsl={$:a.$,$$:a.$$,$checkParams:a.$checkParams,$class:a.$class,$def:c.def,$enum:c["enum"],$fn:c.fn,$global:a.$global,$interface:a.$interface,$module:a.$module,$run:a.$run,$obj:a.$obj};a.DSL=a.$dsl(a.dsl);a.MFunction=a.$module({overload:function(b,c,e){b=a.$overload(b);b.overload(c,e);return b},paramNames:function(a){return c.parseParamNames(a)},methodize:c.methodize});a.MObject=a.$module({trace:c.trace,clone:c.clone,merge:c.merge,mix:c.mix,dsl:a.$dsl,meta:a.meta.get,
setMeta:a.meta.set,hasMeta:a.meta.has,forEach:c.forEach,support:function(b,c){return a.$support(c,b)},implement:function(b,c){return a.$implement(c,b)},is:function(b,c){return a.$is(c,b)},include:function(b,c,e){return a.$include(c,b,e)}});a.init=function(b){b=a.util.merge({injectPrototype:!0},b);b.injectPrototype?(a.$include(a.MObject,Object.prototype,{methodize:!0,context:null}),Object.keys(a.MObject).forEach(function(b){a.HOST[b]=void 0}),a.$include(a.MFunction,Function.prototype,{methodize:!0,
context:null})):(a.$include(a.MObject,a.Base.prototype,{methodize:!0}),a.$.regist(Object,a.MObject,{methodize:!0}),a.$.regist(Function,a.MFunction,{methodize:!0}))}},Mayjs);
