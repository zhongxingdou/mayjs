(function(a){var b=function(d,e){if(b.defined(d))throw d+" defined";var c=e||eval(d);a[d]=c;c=b.__variables__;-1==c.indexOf(d)&&c.push(d)};b.defined=function(d){return a.hasOwnProperty?a.hasOwnProperty(d):"undefined"!==typeof a[d]};Object.defineProperty(b,"__variables__",{value:[],writable:!0});b.del=function(d){var b=this.__variables__.indexOf(d);if(0<=b){var c=this.__variables__;this.__variables__=c.slice(0,b)+c.slice(b+1)}a[d]=null;delete a[d]};b.list=function(){return[].concat(this.__variables__)};
"undefined"==typeof console&&(console={},"info log error debug warn trace dir".split(" ").forEach(function(){console.name=function(){}}));b("Mayjs",{$global:b,$run:function(a){return 1==arguments.length?a():a.apply(this,Array.prototype.slice.call(arguments,1))},HOST:a,$dsl:function(a){var a=a||this,b="_temp"+Date.now();eval(b+"={value: {}}");eval(b).value=a;return"var "+Object.keys(a).filter(function(c){return a.hasOwnProperty(c)&&"function"==typeof a[c]}).map(function(a){return a+"="+b+".value['"+
a+"']"}).join(",")+"; delete "+b}})})(this);
Mayjs.util=Mayjs.$run(function(){return{toObject:function(a){var b=typeof a,d=a;-1==["object","function"].indexOf(b)&&(d=new (eval(b.charAt(0).toUpperCase()+b.slice(1)))(a));return d},parseParamNames:function(a){return(a=a.toString().match(/.*?\((.*)?\)/))&&a[1]?a[1].split(","):[]},fn:function(){return arguments.callee.caller.apply(this,arguments)},parseArray:function(a){return Array.prototype.slice.call(a,0)},trace:function(a,b,d){for(;a;){if(!1===d(a))return!1;a=a[b]}return!0},mix:function(a,b,
d){if(!b)return a;var e;if(d&&0<d.length)for(e in b)-1==d.indexOf(e)&&(a[e]=b[e]);else for(e in b)a[e]=b[e];return a},"enum":function(a){if("object"==typeof a)return arguments[0];for(var b={},d=0,e=arguments.length;d<e;d++)b[arguments[d]]={};return b},clone:function(a,b){var d={},e;for(e in a)d[e]=b?$clone(a[e]):a[e];return d},methodize:function(a,b,d){var e=Array.prototype.slice;return function(){b=b||this;var c=[d?d(b):b].concat(e.call(arguments,0));return a.apply(null,c)}},merge:function(a,b,d,
e){for(var c={},g=null,f,h=0,i=arguments.length;h<i;h++)for(f in g=arguments[h],g)c[f]=g[f];return c}}},Mayjs);Mayjs.meta=Mayjs.$run(function(){var a=function(a){/^__.*__$/.test(a)||(a="__"+a+"__");return a};return{set:function(b,d,e,c){Object.defineProperty(b,a(d),{value:e,writable:!0!==c})},get:function(b,d){return b[a(d)]},has:function(b,d){return b.hasOwnProperty(a(d))}}});
Mayjs.$run(function(a){function b(a,f){var c=[];if(e(Array,a)){var b=a.length,h;if(f)for(h=0;h<b;h++)c.push({name:f[h],type:a[h]});else for(h=0;h<b;h+=2)c.push({name:a[h],type:a[h+1]})}else c.push({name:f[0],type:d(a)});return c}function d(a,c){if(c){if(!h.isPrototypeOf(c))throw"Parameter base is not an Interface";interface_=Object.create(c)}else interface_=Object.create(h);f.mix(interface_,a);return interface_}function e(a,f){if(null===a)return null===f;if(void 0===a)return void 0===f;var b=!1;switch(typeof a){case "string":b=
typeof f==a;break;case "object":b=h.isPrototypeOf(a)?c(a,f):a.isPrototypeOf(f);break;case "function":b=(b=a.prototype)?b.isPrototypeOf(f):f instanceof a}return b}function c(a,f){if(g.has(f,"interfaces")&&-1!=g.get(f,"interfaces").indexOf(a))return!0;for(var c in a)if(!/^__.*__$/.test(c))if(e(Array,a[c])){if(!e("function",f[c]))return!1}else if(!e(a[c],f[c]))return!1;return!0}var g=a.meta,f=a.util,h={};a.$interface=d;a.$implement=function(a,f){g.has(f,"interfaces")||g.set(f,"interfaces",[]);var h=
g.get(f,"interfaces");if(-1==h.indexOf(a)){if(!c(a,f))throw"Not support interface";Object.keys(a).forEach(function(c){e(Array,a[c])&&g.set(f[c],"param_types",b(a[c]))});h.push(a)}};a.$support=c;a.$is=e;a.$checkParams=function(){for(var a=arguments.callee.caller,c=a.arguments,a=0===arguments.length?g.get(a,"param_types"):b(f.parseArray(arguments),f.parseParamNames(a)),h,d=0,j=c.length;d<j;d++){h=a[d].type;if(null===h)break;if(!e(h,c[d]))return!1}return!0};a.util.def=function(a,c){g.set(c,"param_types",
b(a,f.parseParamNames(c)));return c};a.Interface=h},Mayjs);
Mayjs.$run(function(a){var b=a.meta,d=a.util;a.$module=function(a){return a};a.$include=function(e,c,g){var g=d.merge({methodize:!1,context:c,methodizeTo:null,alias:null},e.includeOption,g),f=g.methodize;Object.keys(e).forEach(function(a){var b=g.alias&&g.alias[a]?g.alias[a]:a;if(!/^__.*__$/.test(a)&&-1==["onIncluded","includeOption"].indexOf(a)){var k=e[a];c[b]=f&&"function"==typeof k?d.methodize(k,g.context,g.methodizeTo):e[a]}});b.has("interfaces")&&b.get("interfaces").forEach(function(f){a.$implement(f,
c)});e.onIncluded&&e.onIncluded.call(c,g.context)}},Mayjs);
Mayjs.$run(function(a){function b(a,c){var b=Object.create(a),g;Object.__proto__?g=function(){var a=g.prototype.initialize;a&&a.apply(this,arguments)}:(d.set(b,"proto",a,!0),g=function(){this.__proto__=b;var a=g.prototype.initialize;a&&a.apply(this,arguments)});if(!g.extend){var e=arguments.callee;g.extend=function(a){return e(this.prototype,a)}}for(var l in c){var j=c[l];"function"==typeof j&&d.set(j,"name",l);b[l]=j}d.set(b,"interfaces",[]);g.prototype=b;return g}var d=a.meta,e=a.util,c=a.$interface({initialize:[],
__interfaces__:Array}),g=b(Object.prototype,{initialize:function(){d.set(this,"interfaces",[])},_callerOwner:function(a,c){var b=null;if(c){if(this.__proto__[c]==a)return this.__proto__;e.trace(this,"__proto__",function(d){if(d.hasOwnProperty(c)&&d[c]==a)return b=d,!1})}else e.trace(this,"__proto__",function(c){Object.keys(c).forEach(function(g){if(c[g]==a)return b=c,d.set(a,"name",g),!1})});return b},base:function(){var a=arguments.callee.caller,c=a.name||d.get(a,"name"),b=this._callerOwner(a,c);
c||(c=d.get(a,"name"));c=(a=b?d.get(b,"proto"):null)?a[c]:null;if("function"==typeof c)return c.apply(this,arguments)},include:function(c,b){a.$include(c,this,b);return this},implement:function(c){a.$implement(c,this);return this},supported:function(a){return-1!=this.meta("interfaces").indexOf(a)},meta:function(a){return d.get(this,a)},dsl:a.$dsl});a.$implement(c,g.prototype);g.extend=function(a){var c=b(this.prototype,a);a.initialize||(c.prototype.initialize=function(){this.base()});return c};a.$extend=
b;a.Base=g;a.IBase=c;a.$class=function(a){return g.extend(a)}},Mayjs);
Mayjs.$run(function(a){function b(c){var c=d.toObject(c),b=arguments.callee.findWrappersByObj(c);if(0===b.length)return c;var f=new a.Base;b.forEach(function(b){a.$include(b.module,f,d.merge({context:c},b.includeOption))});return f}var d=a.util,e=a.meta;e.set(b,"map",[]);d.mix(b,{findWrappersByType:function(a){var d=e.get(b,"map").filter(function(b){return b.type==a});return 0===d.length?[]:d[0].modules},findWrappersByPrototype:function(a){for(var b=[],f;a&&!(b=b.concat(this.findWrappersByType(a)),
f=a,a=f.__proto__||(f.constructor?f.constructor.prototype:null),a==f););return b},findWrappersByObj:function(a){if(null===a)return[];var d=[],f=typeof a;"object"==f||"function"==f?(d=d.concat(b.findWrappersByPrototype(a.__proto__||a.constructor.prototype)),e.has(a,"interfaces")&&Maysj.meta.get(a,"interfaces").forEach(function(a){d=d.concat(b.findWrappersByType(a))})):d=d.concat(b.findWrappersByType(f));return d},exists:function(a,d){return 0<e.get(b,"map").filter(function(b){return b.type==a}).filter(function(a){return a.module==
d}).length},regist:function(a,b,f){if(a!=Function.prototype&&("function"==typeof a&&(a=a.prototype),a!=Function.prototype&&(!a||-1==["string","object"].indexOf(typeof a))))return;if("object"==typeof b){var h=e.get(this,"map"),i=h.filter(function(b){return b.type==a}),f={module:b,includeOption:d.merge(b.includeOption,f)};0===i.length?(i={type:a,modules:[f]},h.push(i)):0===i.modules.filter(function(a){return a.module==b}).length&&i.modules.push(f);return this}}});a.$=b;a.$$=function(c){var c=d.toObject(c),
e=b.findWrappersByObj(c);if(0===e.length)return c;e.forEach(function(b){a.$include(b.module,c,b.includeOption)});return c}},Mayjs);
Mayjs.$run(function(a){function b(b,e){for(var f=b||arguments.callee.caller,h=d.get(f,"param_types"),e=e||f.arguments,i=0,k=e.length;i<k;i++){f=h[i].type;if(null===f)break;if(!a.$is(f,e[i]))return!1}return!0}var d=a.meta,e=a.util;a.$overload=function(a,g){var f=[e.def(a,g)],h=function(){var a=arguments,c;a:{c=a;var e=c.length,h=function(a){return d.get(a,"param_types")},g=f.filter(function(a){return h(a).length>=e});if(1>=g.length)c=g[0];else{for(var g=g.sort(function(a,b){return h(a).length-h(b).length}),
m;m=g.shift();)if(b(m,c)){c=m;break a}c=void 0}}if(c)return c.apply(this,a)};h.overload||(h.overload=function(a,b){f.push(e.def(a,b));return this});return h}},Mayjs);
Mayjs.dsl=Mayjs.$run(function(a,b){var d=a.util,e={};a.MFunction=a.$module({overload:function(b,c){return a.$overload(c,b)},paramNames:function(b){return a.util.parseParamNames(b)},methodize:d.methodize});a.MObject=a.$module({trace:d.trace,clone:d.clone,merge:d.merge,mix:d.mix,dsl:a.$dsl,meta:a.meta.get,setMeta:a.meta.set,hasMeta:a.meta.has,support:function(b,c){return a.$support(c,b)},implement:function(b,c){return a.$implement(c,b)},is:function(b,c){return a.$is(c,b)},include:function(b,c,d){return a.$include(c,
b,d)}});var c="parseParamNames toObject clone overload parseArray trace methodize mix merge".split(" ");Object.keys(d).forEach(function(a){-1==c.indexOf(a)&&(e["$"+a]=d[a])});var g="$dsl $support $is $extend $implement $include $overload".split(" ");Object.keys(a).forEach(function(b){/^\$/.test(b)&&-1==g.indexOf(b)&&(e[b]=a[b])});a.init=function(c){c=a.util.merge({injectPrototype:!0},c);c.injectPrototype?(a.$include(a.MObject,Object.prototype,{methodize:!0}),Object.keys(a.MObject).forEach(function(a){b[a]=
void 0}),a.$include(a.MFunction,Function.prototype,{methodize:!0})):(a.$.regist(Object,a.MObject,{methodize:!0}),a.$.regist(Function,a.MFunction,{methodize:!0}))};return e},Mayjs,this);Mayjs.DSL=Mayjs.$dsl(Mayjs.dsl);
