(function(a){var b=function(d,f){if(b.defined(d))throw d+" defined";var c=f||eval(d);a[d]=c;c=b.__variables__;-1==c.indexOf(d)&&c.push(d)};b.defined=function(d){return a.hasOwnProperty?a.hasOwnProperty(d):"undefined"!==typeof a[d]};Object.defineProperty(b,"__variables__",{value:[],writable:!0});b.del=function(d){var b=this.__variables__.indexOf(d);if(0<=b){var c=this.__variables__;this.__variables__=c.slice(0,b)+c.slice(b+1)}a[d]=null;delete a[d]};b.list=function(){return[].concat(this.__variables__)};
"undefined"==typeof console&&(console={},"info log error debug warn trace dir".split(" ").forEach(function(){console.name=function(){}}));b("Mayjs",{$global:b,$run:function(a){return 1==arguments.length?a():a.apply(this,Array.prototype.slice.call(arguments,1))},HOST:a,$dsl:function(a){var a=a||this,b="_temp"+Date.now();eval(b+"={value: {}}");eval(b).value=a;return"var "+Object.keys(a).map(function(a){return a+"="+b+".value['"+a+"']"}).join(",")+"; delete "+b}})})(this);
Mayjs.util=Mayjs.$run(function(){return{toObject:function(a){var b=typeof a,d=a;-1==["object","function"].indexOf(b)&&(d=new (eval(b.charAt(0).toUpperCase()+b.slice(1)))(a));return d},parseParamNames:function(a){return(a=a.toString().match(/.*?\((.*)?\)/))&&a[1]?a[1].split(","):[]},fn:function(){return arguments.callee.caller.apply(this,arguments)},parseArray:function(a){return Array.prototype.slice.call(a,0)},trace:function(a,b,d){for(;a;){if(!1===d(a))return!1;a=a[b]}return!0},mix:function(a,b,
d){if(!a)return b;var f;if(d&&0<d.length)for(f in a)-1==d.indexOf(f)&&(b[f]=a[f]);else for(f in a)b[f]=a[f];return b},"enum":function(a){if("object"==typeof a)return arguments[0];for(var b={},d=0,f=arguments.length;d<f;d++)b[arguments[d]]={};return b},clone:function(a,b){var d={},f;for(f in a)d[f]=b?$clone(a[f]):a[f];return d},methodize:function(a,b,d){var f=Array.prototype.slice;return function(){b=b||this;var c=[d?d(b):b].concat(f.call(arguments,0));return a.apply(null,c)}},merge:function(a,b,d,
f){for(var c={},e=null,h,g=0,i=arguments.length;g<i;g++)for(h in e=arguments[g],e)c[h]=e[h];return c}}},Mayjs);Mayjs.meta=Mayjs.$run(function(){var a=function(a){/^__.*__$/.test(a)||(a="__"+a+"__");return a};return{set:function(b,d,f,c){Object.defineProperty(b,a(d),{value:f,writable:!0!==c})},get:function(b,d){return b[a(d)]},has:function(b,d){return b.hasOwnProperty(a(d))}}});
Mayjs.$run(function(a){function b(a,c){var b=[];if(f(Array,a)){var h=a.length,e;if(c)for(e=0;e<h;e++)b.push({name:c[e],type:a[e]});else for(e=0;e<h;e+=2)b.push({name:a[e],type:a[e+1]})}else b.push({name:c[0],type:d(a)});return b}function d(a,c){if(c){if(!g.isPrototypeOf(c))throw"Parameter base is not an Interface";interface_=Object.create(c)}else interface_=Object.create(g);h.mix(a,interface_);return interface_}function f(a,b){if(null===a)return null===b;if(void 0===a)return void 0===b;var e=!1;switch(typeof a){case "string":e=
typeof b==a;break;case "object":e=g.isPrototypeOf(a)?c(a,b):a.isPrototypeOf(b);break;case "function":e=(e=a.prototype)?e.isPrototypeOf(b):b instanceof a}return e}function c(a,c){if(e.has(c,"interfaces")&&-1!=e.get(c,"interfaces").indexOf(a))return!0;for(var b in a)if(!/^__.*__$/.test(b))if(f(Array,a[b])){if(!f("function",c[b]))return!1}else if(!f(a[b],c[b]))return!1;return!0}var e=a.meta,h=a.util,g={};a.$interface=d;a.$implement=function(a,h){e.has(h,"interfaces")||e.set(h,"interfaces",[]);var d=
e.get(h,"interfaces");if(-1==d.indexOf(a)){if(!c(a,h))throw"Not support interface";Object.keys(a).forEach(function(c){f(Array,a[c])&&e.set(h[c],"paramspec",b(a[c]))});d.push(a)}};a.$support=c;a.$is=f;a.$checkParams=function(){for(var a=arguments.callee.caller,c=a.arguments,a=0===arguments.length?e.get(a,"paramspec"):b(h.parseArray(arguments),h.parseParamNames(a)),d,g=0,j=c.length;g<j;g++){d=a[g].type;if(null===d)break;if(!f(d,c[g]))return!1}return!0};a.util.def=function(a,c){e.set(c,"paramspec",b(a,
h.parseParamNames(c)));return c};a.Interface=g},Mayjs);
Mayjs.$run(function(a){var b=a.meta,d=a.util;a.$module=function(a){return a};a.$include=function(f,c,e){var e=d.merge({methodize:!1,context:c,methodizeTo:null,alias:null},f.includeOption,e),h=e.methodize;Object.keys(f).forEach(function(a){var b=e.alias&&e.alias[a]?e.alias[a]:a;if(!/^__.*__$/.test(a)&&-1==["onIncluded","includeOption"].indexOf(a)){var k=f[a];c[b]=h&&"function"==typeof k?d.methodize(k,e.context,e.methodizeTo):f[a]}});b.has("interfaces")&&b.get("interfaces").forEach(function(b){a.$implement(b,
c)});f.onIncluded&&f.onIncluded.call(c,e.context)}},Mayjs);
Mayjs.$run(function(a){function b(a,c){var b=Object.create(a),e;Object.__proto__?e=function(){var a=e.prototype.initialize;a&&a.apply(this,arguments)}:(d.set(b,"proto",a,!0),e=function(){this.__proto__=b;var a=e.prototype.initialize;a&&a.apply(this,arguments)});if(!e.extend){var f=arguments.callee;e.extend=function(a){return f(this.prototype,a)}}for(var l in c){var j=c[l];"function"==typeof j&&d.set(j,"name",l);b[l]=j}d.set(b,"interfaces",[]);e.prototype=b;return e}var d=a.meta,f=a.util,c=a.$interface({initialize:[],
__interfaces__:Array}),e=b(Object.prototype,{initialize:function(){d.set(this,"interfaces",[])},_callerOwner:function(a,c){var b=null;if(c){if(this.__proto__[c]==a)return this.__proto__;f.trace(this,"__proto__",function(e){if(e.hasOwnProperty(c)&&e[c]==a)return b=e,!1})}else f.trace(this,"__proto__",function(c){Object.keys(c).forEach(function(e){if(c[e]==a)return b=c,d.set(a,"name",e),!1})});return b},base:function(){var a=arguments.callee.caller,c=a.name||d.get(a,"name"),b=this._callerOwner(a,c);
c||(c=d.get(a,"name"));c=(a=b?d.get(b,"proto"):null)?a[c]:null;if("function"==typeof c)return c.apply(this,arguments)},include:function(c,b){a.$include(c,this,b);return this},implement:function(c){a.$implement(c,this);return this},supported:function(a){return-1!=this.meta("interfaces").indexOf(a)},meta:function(a){return d.get(this,a)},dsl:a.$dsl});a.$implement(c,e.prototype);e.extend=function(a){var c=b(this.prototype,a);a.initialize||(c.prototype.initialize=function(){this.base()});return c};a.$extend=
b;a.Base=e;a.IBase=c;a.$class=function(a){return e.extend(a)}},Mayjs);
Mayjs.$run(function(a){function b(c){var b=arguments.callee.findWrappersByObj(c),c=d.toObject(c);if(0===b.length)return c;var f=new a.Base;b.forEach(function(a){f.include(a.module,d.merge({context:c},a.includeOption))});return f}var d=a.util,f=a.meta;f.set(b,"map",{});d.mix({findWrappersByType:function(a){return f.get(b,"map")[a]||[]},findWrappersByPrototype:function(a){for(var b=[],d;a&&!(b=b.concat(this.findWrappersByType(a)),d=a,a=d.prototype||(d.constructor?d.constructor.prototype:null),a==d););
return b},findWrappersByObj:function(a){if(null===a)return[];var e=[],d=typeof a;"object"==d?(e=e.concat(b.findWrappersByPrototype(a.prototype||a.constructor.prototype)),f.has(a,"interfaces")&&Maysj.meta.get(a,"interfaces").forEach(function(a){e=e.concat(b.findWrappersByType(a))})):e=e.concat(b.findWrappersByType(d));return e},exists:function(a,e){var d=f.get(b,"map")[a];return!d||1>d.length?!1:0<d.filter(function(a){return a.module==e}).length},regist:function(a,b,h){"function"==typeof a&&(a=a.prototype);
if(a&&-1!=["string","object"].indexOf(typeof a)&&"object"==typeof b){var g=f.get(this,"map"),i=g[a];i||(i=g[a]=[]);this.exists(a,b)||i.push({module:b,includeOption:d.merge(b.includeOption,h)});return this}}},b);a.$=b;a.$$=function(c){var e=b.findWrappersByObj(c),c=d.toObject(c);if(0===e.length)return c;e.forEach(function(b){a.$include(b.module,c,b.includeOption)});return c}},Mayjs);
Mayjs.$run(function(a){function b(b,e){for(var f=b||arguments.callee.caller,g=d.get(f,"paramspec"),e=e||f.arguments,i=0,k=e.length;i<k;i++){f=g[i].type;if(null===f)break;if(!a.$is(f,e[i]))return!1}return!0}var d=a.meta,f=a.util;a.$overload=function(a,e){var h=[f.def(a,e)],g=function(){var a=arguments,c;a:{c=a;var e=c.length,f=h.filter(function(a){return d.get(a,"paramspec").length>=e});if(1>=f.length)c=f[0];else{for(var f=f.sort(function(a,b){return d.get(a,"paramspec").length-d.get(b,"paramspec").length}),
g;g=f.shift();)if(b(g,c)){c=g;break a}c=void 0}}if(c)return c.apply(this,a)};g.overload=function(a,b){h.push(f.def(a,b));return this};return g}},Mayjs);Mayjs.dsl=Mayjs.$run(function(a){var b=a.util,d={$obj:function(b){var d=new this.Base;a.util.mix(b,d);return d},$meta:function(b,d){return a.meta.get(b,d)}},f=["parseParamNames","def"];Object.keys(b).forEach(function(a){-1==f.indexOf(a)&&(d["$"+a]=b[a])});Object.keys(a).forEach(function(b){/^\$/.test(b)&&(d[b]=a[b])});return d},Mayjs);Mayjs.DSL=Mayjs.$dsl(Mayjs.dsl);
