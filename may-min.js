(function(d){var b=function(c,e){if(b.defined(c))throw c+" defined";var a=e||eval(c);d[c]=a;a=b.__variables__;-1==a.indexOf(c)&&a.push(c)};b.defined=function(c){return d.hasOwnProperty?d.hasOwnProperty(c):"undefined"!==typeof d[c]};Object.defineProperty(b,"__variables__",{value:[],writable:!0});b.del=function(c){var b=this.__variables__.indexOf(c);if(0<=b){var a=this.__variables__;this.__variables__=a.slice(0,b)+a.slice(b+1)}d[c]=null;delete d[c]};b.list=function(){return[].concat(this.__variables__)};
"undefined"==typeof console&&(console={},"info log error debug warn trace dir".split(" ").forEach(function(){console.name=function(){}}));b("Mayjs",{$global:b,$run:function(c){return 1==arguments.length?c():c.apply(this,Array.prototype.slice.call(arguments,1))},HOST:d,$dsl:function(c){var c=c||this,b="_temp"+Date.now();eval(b+"={value: {}}");eval(b).value=c;return"var "+Object.keys(c).map(function(a){return a+"="+b+".value['"+a+"']"}).join(",")+"; delete "+b}})})(this);
Mayjs.util=Mayjs.$run(function(d){return{toObject:function(b){var c=typeof b,e=b;-1==["object","function"].indexOf(c)&&(e=new (eval(c.charAt(0).toUpperCase()+c.slice(1)))(b));return e},parseParamNames:function(b){return(b=b.toString().match(/.*?\((.*)?\)/))&&b[1]?b[1].split(","):[]},fn:function(){return arguments.callee.caller.apply(this,arguments)},parseArray:function(b){return Array.prototype.slice.call(b,0)},trace:function(b,c,e){for(;b;){if(!1===e(b))return!1;b=b[c]}return!0},mix:function(b,c,
e){if(!b)return c;var a;if(e&&0<e.length)for(a in b)-1==e.indexOf(a)&&(c[a]=b[a]);else for(a in b)c[a]=b[a];return c},"enum":function(b){if("object"==typeof b)return arguments[0];for(var c={},e=0,a=arguments.length;e<a;e++)c[arguments[e]]={};return c},clone:function(b,c){var e={},a;for(a in b)e[a]=c?$clone(b[a]):b[a];return e},methodize:function(b,c,e){var a=Array.prototype.slice;return function(){c=c||this;var d=[e?e(c):c].concat(a.call(arguments,0));return b.apply(null,d)}},merge:function(b,c,e){var a=
d.util,c=a.clone(c);a.mix(b||{},c,e);return c}}},Mayjs);Mayjs.meta=Mayjs.$run(function(){var d=function(b){/^__.*__$/.test(b)||(b="__"+b+"__");return b};return{set:function(b,c,e,a){Object.defineProperty(b,d(c),{value:e,writable:!0!==a})},get:function(b,c){return b[d(c)]},has:function(b,c){return b.hasOwnProperty(d(c))}}});
Mayjs.$run(function(d){function b(a,b){var d=[];if(e(Array,a)){var g=a.length,f;if(b)for(f=0;f<g;f++)d.push({name:b[f],type:a[f]});else for(f=0;f<g;f+=2)d.push({name:a[f],type:a[f+1]})}else d.push({name:b[0],type:c(a)});return d}function c(a,b){if(b){if(!h.isPrototypeOf(b))throw"Parameter base is not an Interface";interface_=Object.create(b)}else interface_=Object.create(h);g.mix(a,interface_);return interface_}function e(b,c){if(null===b)return null===c;var d=!1;switch(typeof b){case "string":d=
typeof c==b;break;case "object":d=h.isPrototypeOf(b)?a(b,c):b.isPrototypeOf(c);break;case "function":d=(d=b.prototype)?d.isPrototypeOf(c):c instanceof b}return d}function a(a,b){if(f.has(b,"interfaces")&&-1!=f.get(b,"interfaces").indexOf(a))return!0;for(var c in a)if(e(Array,a[c])){if(!e("function",b[c]))return!1}else if(!e(a[c],b[c]))return!1;return!0}var f=d.meta,g=d.util,h={};d.$interface=c;d.$implement=function(c,d){f.has(d,"interfaces")||f.set(d,"interfaces",[]);var g=f.get(d,"interfaces");if(-1==
g.indexOf(c)){if(!a(c,d))throw"Not support interface";Object.keys(c).forEach(function(a){e(Array,c[a])&&f.set(d[a],"paramspec",b(c[a]))});g.push(c)}};d.$support=a;d.$is=e;d.$checkParams=function(){for(var a=arguments.callee.caller,c=a.arguments,a=0===arguments.length?f.get(a,"paramspec"):b(g.parseArray(arguments),g.parseParamNames(a)),d,h=0,m=c.length;h<m;h++){d=a[h].type;if(null===d)break;if(!e(d,c[h]))return!1}return!0};d.$def=function(a,c){f.set(c,"paramspec",b(a,g.parseParamNames(c)));return c};
d.Interface=h},Mayjs);
Mayjs.$run(function(d){var b=d.meta,c=d.util;d.$module=function(c){return c};d.$include=function(e,a,f){var f=c.merge(f,c.merge(e.includeOption,{methodize:!1,context:a,methodizeTo:null,alias:null})),g=f.methodize;Object.keys(e).forEach(function(b){var d=f.alias&&f.alias[b]?f.alias[b]:b;if(!/^__.*__$/.test(b)&&-1==["onIncluded","includeOption"].indexOf(b)){var i=e[b];a[d]=g&&"function"==typeof i?c.methodize(i,f.context,f.methodizeTo):e[b]}});b.has("interfaces")&&b.get("interfaces").forEach(function(b){d.$implement(b,a)});
e.onIncluded&&e.onIncluded.call(a,f.context)}},Mayjs);
Mayjs.$run(function(d){function b(a,b){var f=function(){var a=f.prototype.initialize;a&&a.apply(this,arguments)};c.set(f,"config",b,!0);var i=Object.create(a);i.__proto__||c.set(i,"proto",a,!0);var j=b["@statics"];j&&e.mix(j,f);if(!f.extend){var l=arguments.callee;f.extend=function(a){return l(this.prototype,a)}}f.prototype=i;Object.keys(b).filter(function(a){return"@"!=a.charAt(0)&&"constructor"!=a}).forEach(function(a){i[a]=b[a]});c.set(i,"interfaces",[]);if(j=b["@implements"])d.$is(Array,j)||(j=
[j]),j.forEach(function(a){d.$implement(a,i)});return f}var c=d.meta,e=d.util,a=d.$interface({initialize:[],__interfaces__:Array}),f=b(Object.prototype,{"@implements":a,"@statics":{extend:function(a){a.initialize||(a.initialize=function(){this.base()});return b(this.prototype,a)}},initialize:function(){c.set(this,"interfaces",[])},_callerOwner:function(a){var b=null;e.trace(this,"__proto__",function(c){Object.keys(c).forEach(function(d){if(c[d]==a)return b=c,a["@name"]=d,!1});if(b)return!1});return b},
protoMember:function(a){var b=this._callerOwner(arguments.callee.caller);if(b&&(proto=c.get(b,"proto")))return proto[a]},base:function(){var a=arguments.callee.caller,b=this._callerOwner(a),d=a["@name"];delete a["@name"];d=(a=b?c.get(b,"proto"):null)?a[d]:null;if("function"==typeof d)return d.apply(this,arguments)},include:function(a,b){d.$include(a,this,b);return this},implement:function(a){d.$implement(a,this);return this},supported:function(a){return-1!=this.meta("interfaces").indexOf(a)},meta:function(a){return c.get(this,
a)},dsl:d.$dsl});d.$extend=b;d.Base=f;d.IBase=a},Mayjs);
Mayjs.$run(function(d){function b(a){var b=arguments.callee.findWrappersByObj(a),a=c.toObject(a);if(0===b.length)return a;var e=new d.Base;b.forEach(function(b){e.include(b.module,c.merge(b.includeOption,{context:a},["context"]))});return e}var c=d.util,e=d.meta;e.set(b,"map",{});c.mix({findWrappersByType:function(a){return e.get(b,"map")[a]||[]},findWrappersByPrototype:function(a){for(var b=[],c;a&&!(b=b.concat(this.findWrappersByType(a)),c=a,a=c.prototype||(c.constructor?c.constructor.prototype:
null),a==c););return b},findWrappersByObj:function(a){if(null===a)return[];var c=[],d=typeof a;"object"==d?(c=c.concat(b.findWrappersByPrototype(a.prototype||a.constructor.prototype)),e.has(a,"interfaces")&&Maysj.meta.get(a,"interfaces").forEach(function(a){c=c.concat(b.findWrappersByType(a))})):c=c.concat(b.findWrappersByType(d));return c},exists:function(a,c){var d=e.get(b,"map")[a];return!d||1>d.length?!1:0<d.filter(function(a){return a.module==c}).length},regist:function(a,b,c){"function"==typeof a&&
(a=a.prototype);if(a&&-1!=["string","object"].indexOf(typeof a)&&"object"==typeof b){var d=e.get(this,"map"),k=d[a];k||(k=d[a]=[]);this.exists(a,b)||k.push({module:b,includeOption:c});return this}}},b);d.$=b;d.$$=function(a){var e=b.findWrappersByObj(a),a=c.toObject(a);if(0===e.length)return a;e.forEach(function(b){a.include?a.include(b.module,b.includeOption):d.$include(b.module,a,b.includeOption)});return a}},Mayjs);
Mayjs.$run(function(d){function b(b,a){for(var f=b||arguments.callee.caller,g=c.get(f,"paramspec"),a=a||f.arguments,h=0,k=a.length;h<k;h++){f=g[h].type;if(null===f)break;if(!d.$is(f,a[h]))return!1}return!0}var c=d.meta;d.$overload=function(e,a){var f=[d.$def(e,a)],g=function(){var a=arguments,d;a:{d=a;var e=d.length,g=f.filter(function(a){return c.get(a,"paramspec").length>=e});if(1>=g.length)d=g[0];else{for(var g=g.sort(function(a,b){return c.get(a,"paramspec").length-c.get(b,"paramspec").length}),
l;l=g.shift();)if(b(l,d)){d=l;break a}d=void 0}}if(d)return d.apply(this,a)};g.overload=function(a,b){f.push(d.$def(a,b));return this};return g}},Mayjs);Mayjs.dsl=Mayjs.$run(function(d){var b=d.util,c={$obj:function(b){var a=new this.Base;d.util.mix(b,a);return a},$meta:function(b,a){return d.meta.get(b,a)}};Object.keys(b).forEach(function(d){"parseParamNames"!=d&&(c["$"+d]=b[d])});Object.keys(d).forEach(function(b){/^\$/.test(b)&&(c[b]=d[b])});return c},Mayjs);
