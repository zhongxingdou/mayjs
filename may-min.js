(function(j){function B(a,b){var c=[];if(i(Array,a)){var d=a.length,f;if(b)for(f=0;f<d;f++)c.push({name:b[f],type:a[f]});else for(f=0;f<d;f+=2)c.push({name:a[f],type:a[f+1]})}else c.push({name:b[0],type:t(a)});return c}function h(a,b){if(h.exists(a))throw a+" has configd";var c=b||eval(a);j[a]=c;c=h["@variables"];-1==c.indexOf(a)&&c.push(a)}function u(a){var a=a||this,b="_temp"+Date.now();eval(b+"={value: {}}");eval(b).value=a;return"var "+(e(a,"dsl")||Object.keys(a)).map(function(a){return a+"="+
b+".value['"+a+"']"}).join(",")+"; delete "+b}function v(a,b){var c={},d;for(d in a)c[d]=b?v(a[d]):a[d];return c}function k(a,b,c){if(!a)return b;var d;if(c&&0<c.length)for(d in a)-1==c.indexOf(d)&&(b[d]=a[d]);else for(d in a)b[d]=a[d];return b}function p(a,b,c){b=v(b);k(a||{},b,c);return b}function w(a,b,c){var c=p(c,p(a.includeOption,{methodize:!1,context:b,methodizeTo:null,alias:null})),d=c.methodize;Object.keys(a).forEach(function(f){var e=c.alias&&c.alias[f]?c.alias[f]:f;if(!/^__.*__$/.test(f)&&
-1==["onIncluded","includeOption"].indexOf(f)){var g=a[f];if(d&&"function"==typeof g){var h=c.context,i=c.methodizeTo;b[e]=function(){h=h||this;var a=[i?i(h):h].concat(Array.prototype.slice.call(arguments,0));return g.apply(null,a)}}else b[e]=a[f]}});e.has("interfaces")&&e("interfaces").forEach(function(a){x(a,b)});a.onIncluded&&a.onIncluded.call(b,c.context)}function x(a,b){e.has(b,"interfaces")||e.set(b,"interfaces",[]);var c=e(b,"interfaces");if(-1==c.indexOf(a)){if(!q(a,b))throw"Not support interface_";
Object.keys(a).forEach(function(c){i(Array,a[c])&&e.set(b[c],"paramspec",B(a[c]))});c.push(a)}}function r(a,b){var c=function(){var a=c.prototype.initialize;a&&a.apply(this,arguments)};["implement","support","include"].forEach(function(a){c[a]=function(){var b=c.prototype,d=arguments;b&&i("function",b[a])&&b[a].apply(b,d)}});e.set(c,"config",b,!0);var d=Object.create(a);d.__proto__||e.set(d,"proto",a,!0);var f=b["@statics"];f&&k(f,c);c.extend||(c.extend=C);c.prototype=d;Object.keys(b).filter(function(a){return"@"!=
a.charAt(0)&&"constructor"!=a}).forEach(function(a){d[a]=b[a]});e.set(d,"interfaces",[]);return c}function t(a,b){var c;if(b){if(!l.isPrototypeOf(b))throw"Parameter base is not an Interface";c=Object.create(b)}else c=Object.create(l);k(a,c);return c}function i(a,b){if(null===a)return null===b;var c=!1;switch(typeof a){case "string":c=typeof b==a;break;case "object":c=l.isPrototypeOf(a)?q(a,b):a.isPrototypeOf(b);break;case "function":c=(c=a.prototype)?c.isPrototypeOf(b):b instanceof a}return c}function q(a,
b){return e.has(b,"interfaces")&&-1!=e(b,"interfaces").indexOf(a)?!0:a["@base"]&&!q(a["@base"],b)?!1:Object.keys(a).filter(function(a){return"@base"!==a}).every(function(c){return i(Array,a[c])?i("function",b[c]):i(a[c],b[c])})}function y(a){var b=typeof a,c=a;-1==["object","function"].indexOf(b)&&(c=new (eval(b.charAt(0).toUpperCase()+b.slice(1)))(a));return c}function g(a){var b=g.findWrappersByObj(a),a=y(a);if(0===b.length)return a;var c=new z;b.forEach(function(b){c.include(b.module,p(b.includeOption,
{context:a},["context"]))});return c}var m={},s=function(a){/^__.*__$/.test(a)||(a="__"+a+"__");return a},e=function(a,b){return arguments.callee.get(a,b)};e.set=function(a,b,c,d){Object.defineProperty(a,s(b),{value:c,writable:!0!==d})};e.get=function(a,b){return a[s(b)]};e.has=function(a,b){return a.hasOwnProperty(s(b))};h.exists=function(a){return j.hasOwnProperty?j.hasOwnProperty(a):"undefined"!==typeof j[a]};h["@variables"]=[];h.del=function(a){var b=h["@variables"].indexOf(objName);if(0<=b){var c=
h["@variables"];0===b?c.shift():b==c.length-1?c.pop():h["@variables"]=c.slice(0,b)+c.slice(b+1);j[a]=null;delete j[a];return!0}return!1};h.list=function(){return[].concat(h["@variables"])};h("Mayjs",m);j.global={};h("$run",function(a,b){return a.call(b||{})});var C=function(a){return r(this.prototype,a)},z=r(Object.prototype,{"@statics":{extend:function(a){a.initialize||(a.initialize=function(){this.base()});return r(this.prototype,a)}},initialize:function(){e.set(this,"interfaces",[])},_callerOwner:function(a){var b=
null;a:for(var c=function(c){Object.keys(c).forEach(function(d){if(c[d]==a)return b=c,a["@name"]=d,!1});if(b)return!1},d=this;d;){if(!1===c(d))break a;d=d.__proto__}return b},protoMember:function(a){var b=this._callerOwner(arguments.callee.caller);if(b&&(proto=e(b,"proto")))return proto[a]},base:function(){var a=arguments.callee.caller,b=this._callerOwner(a),c=a["@name"];delete a["@name"];c=(a=b?e(b,"proto"):null)?a[c]:null;if(i("function",c))return c.apply(this,arguments)},include:function(a,b){w(a,
this,b);return this},implement:function(a){x(a,this);return this},supported:function(a){return-1!=this.meta("interfaces").indexOf(a)},meta:function(a){return e(this,a)},dsl:u}),l={},n=t({initialize:[],include:["module:",Object,"[includeOption]:",Object],implement:["interface:",l],__interfaces__:Array});z.implement(n);e.set(g,"map",{});g.findWrappersByType=function(a){return e(g,"map")[a]||[]};g.findWrappersByPrototype=function(a){for(var b=[],c;a&&!(b=b.concat(g.findWrappersByType(a)),c=a,a=c.prototype||
(c.constructor?c.constructor.prototype:null),a==c););return b};g.findWrappersByObj=function(a){if(null===a)return[];var b=[],c=typeof a;"object"==c?(b=b.concat(g.findWrappersByPrototype(a.prototype||a.constructor.prototype)),e.has(a,"interfaces")&&e(a,"interfaces").forEach(function(a){b=b.concat(g.findWrappersByType(a))})):b=b.concat(g.findWrappersByType(c));return b};g.exists=function(a,b){var c=e(g,"map")[a];return!c||1>c.length?!1:0<c.filter(function(a){return a.module==b}).length};g.regist=function(a,
b,c){i("function",a)&&(a=a.prototype);if(a&&-1!=["string","object"].indexOf(typeof a)&&"object"==typeof b){var d=e(g,"map"),f=d[a];f||(f=d[a]=[]);g.exists(a,b)||f.push({module:b,includeOption:c});return this}};k(g,function(a){var b=g.findWrappersByObj(a),a=y(a);if(0===b.length)return a;b.forEach(function(b){a.include?a.include(b.module,b.includeOption):w(b.module,a,b.includeOption)});return a});n="$run $fn $parseArray $trace $methodize $module $obj $merge $implement $include $interface $is $support $dsl $overload $ $$ $enum $global $meta $extend $checkParams IBase Base Interface".split(" ");
n.forEach(function(a){m[a]=eval(a)});m.dsl=u;e.set(m,"dsl",n.filter(function(a){return"$"===a.charAt(0)}));if(!h.exists("console")){var A={};"info log error debug warn trace dir".split(" ").forEach(function(){A.name=function(){}});h("console",A)}})(this);
