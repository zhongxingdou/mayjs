/*! mayjs 2013-09-07 */
var Mayjs={VERSION:"0.5",HOST:this};"undefined"!=typeof module&&(module.exports=Mayjs),Mayjs.MObjectUtil={isPrivate:function(a){return/^__/.test(a)},isProtected:function(a){return/^_[^_]*/.test(a)},isPublic:function(a){return!Mayjs.MObjectUtil.isProtected(a)&&!Mayjs.MObjectUtil.isPrivate(a)},has:function(a,b){return a&&a.hasOwnProperty(b)&&"function"!=typeof a[b]||!1},can:function(a,b){return a&&a[b]&&"function"==typeof a[b]||!1},eachKey:function(a,b){for(var c in a)if(b(a[c])===!1)break},eachProp:function(a,b){Mayjs.MObjectUtil.eachOwn(a,function(a,c){return"function"!=typeof c?b(a,c):void 0})},eachOwn:function(a,b){for(var c in a)if(a.hasOwnProperty(c)&&Mayjs.MObjectUtil.isPublic(c)&&b(c,a[c])===!1)break},trace:function(a,b,c){for(var d=a;d;){if(c(d)===!1)return!1;d=d[b]}return!0},clone:function(a,b){var c={};for(var d in a)c[d]=b?$clone(a[d]):a[d];return c},delegate:function(a,b){return a[b].bind(a)},set:function(a,b,c){return a[b]=c,a},get:function(a,b){return a[b]},call:function(a,b){b=a[b];var c=util.parseArray(arguments).split(2);return b.apply(a,c)},mix:function(a,b,c){if(!b)return a;var d;if(c&&c.length>0)for(d in b)-1==c.indexOf(d)&&(a[d]=b[d]);else for(d in b)a[d]=b[d];return a},merge:function(){for(var a,b={},c=null,d=0,e=arguments.length;e>d;d++)if(c=arguments[d])for(a in c)b[a]=c[a];return b}},$global=function(HOST){var $global=function(globalName,obj){var _global=arguments.callee;if(_global.defined(globalName))throw globalName+" has been defined";var o=obj||eval(globalName);HOST[globalName]=o,_global.regist(globalName)};return $global.defined="undefined"!=typeof exports?function(globalName){return"undefined"!=typeof eval(globalName)}:function(a){return HOST.hasOwnProperty?HOST.hasOwnProperty(a):"undefined"!=typeof HOST[a]},Object.defineProperty($global,"__variables__",{value:[],writable:!0}),$global.del=function(a){var b=this.__variables__.indexOf(a);if(b>=0){var c=this.__variables__;this.__variables__=c.slice(0,b).concat(c.slice(b+1))}HOST[a]=null,delete HOST[a]},$global.list=function(){return[].concat(this.__variables__)},$global.regist=function(a){if(!this.defined(a))throw a+" is undefined";var b=this.__variables__;-1==b.indexOf(a)&&b.push(a)},$global}(this),"undefined"!=typeof Mayjs&&Mayjs&&(Mayjs.$global=$global,Mayjs.$global.regist("Mayjs"),$global=void 0);var MayjsUtil={toObject:function(value){var type=typeof value,obj=value;if(-1==["object","function"].indexOf(type)){var Type=eval(type.charAt(0).toUpperCase()+type.slice(1));obj=new Type(value)}return obj},parseParamNames:function(a){var b=a.toString().match(/.*?\((.*)?\)/);return b&&b[1]?b[1].split(","):[]},fn:function(){return arguments.callee.caller.apply(this,arguments)},parseArray:function(a){return Array.prototype.slice.call(a,0)},enumeration:function(a){if("object"==typeof a)return arguments[0];for(var b={},c=0,d=arguments.length;d>c;c++)b[arguments[c]]={};return b},methodize:function(a,b,c){var d=Array.prototype.slice;return function(){var e=b||this,f=[c?c(e):e].concat(d.call(arguments,0));return a.apply(null,f)}},overwrite:function(a,b,c){var d=a[b].bind(a);a[b]=function(){var b=[d].concat(Mayjs.util.parseArray(arguments));return c.apply(a,b)}},$var:function(obj,names){obj=obj||this;var tempVarName="_temp"+Date.now();eval(tempVarName+"={value: {}}");var temp=eval(tempVarName);temp.value=obj,"string"==typeof names&&""!==names?names=names.split(" ").map(function(a){return a.trim()}):names||(names=Object.keys(obj));var members=names.map(function(a){return a+"="+tempVarName+".value"+"['"+a+"']"});return"var "+members.join(",")+"; delete "+tempVarName},run:function(a){return 1==arguments.length?a():a.apply(this,Array.prototype.slice.call(arguments,1))}};"undefined"!=typeof Mayjs&&Mayjs&&(Mayjs.util=MayjsUtil,Mayjs.$run=MayjsUtil.run,Mayjs.$var=MayjsUtil.$var,Mayjs.$fn=MayjsUtil.fn,Mayjs.$enum=MayjsUtil.enumeration,MayjsUtil=void 0);var meta=function(){var a=function(a){return/^__.*__$/.test(a)||(a="__"+a+"__"),a};return{set:function(b,c,d,e){Object.defineProperty(b,a(c),{value:d,writable:e!==!0})},get:function(b,c){return b[a(c)]},has:function(b,c){return b.hasOwnProperty(a(c))}}}();"undefined"!=typeof Mayjs&&Mayjs&&(Mayjs.meta=meta,meta=void 0),Mayjs.$run(function(a){function b(a,b){var c=[];if(e(Array,a))if(b)for(var f=0,g=b.length;g>f;f++)c.push({name:b[f],type:a[f]});else a.forEach(function(a){l(a,function(a,b){return c.push({name:a,type:b}),!1})});else c.push({name:b[0],type:d(a)});return c}function c(a,c){return i.set(c,"param_types",b(a,k(c))),c}function d(a,b){return interface_=b?Object.create(b):Object.create(n),m(interface_,a),interface_}function e(a,b){if(null===a)return null===b;if(void 0===a)return void 0===b;var c=!1;switch(typeof a){case"string":c=typeof b==a;break;case"object":c=n.isPrototypeOf(a)?f(a,b):a.isPrototypeOf(b);break;case"function":var d=a.prototype;c=d?d.isPrototypeOf(b):b instanceof a}return c}function f(a,b){if(i.has(b,"interfaces")&&-1!=i.get(b,"interfaces").indexOf(a))return!0;for(var c in a)if(!/^__.*__$/.test(c))if(e(Array,a[c])){if(!e("function",b[c]))return!1}else if(!e(a[c],b[c]))return!1;return!0}function g(a,c){i.has(c,"interfaces")||i.set(c,"interfaces",[]);var d=i.get(c,"interfaces");if(-1==d.indexOf(a)){if(!f(a,c))throw"not supported interface";Object.keys(a).forEach(function(d){e(Array,a[d])&&i.set(c[d],"param_types",b(a[d]))}),d.push(a)}}function h(){var a,c=arguments.callee.caller,d=c.arguments;a=0===arguments.length?i.get(c,"param_types"):b(j(arguments),k(c));for(var f,g=0,h=d.length;h>g;g++){if(f=a[g].type,null===f)return!0;if(!e(f,d[g]))return!1}return!0}var i=a.meta,j=a.util.parseArray,k=a.util.parseParamNames,l=a.MObjectUtil.eachOwn,m=a.MObjectUtil.mix,n={};a.$interface=d,a.$implement=g,a.$support=f,a.$is=e,a.$check=h,a.$def=c,a.Interface=n},Mayjs),Mayjs.$run(function(a){function b(a){return a}function c(b){var c=b.option,h=b.module,k=b.to,l={methodize:!1,context:null,methodizeTo:null,alias:null,forceInclude:!1};c=f(l,c),d.has(k,"modules")||d.set(k,"modules",[]);var m=i(k);if(-1==m.indexOf(h)||c.forceInclude){var n=c.methodize;g(h,function(a,b){if("onIncluded"!=a){var d=c.alias&&c.alias[a]?c.alias[a]:a;k[d]=n&&"function"==typeof b?e(b,c.context,c.methodizeTo):b}}),d.has(h,"interfaces")&&d.get(h,"interfaces").forEach(function(b){a.$implement(b,k)}),j(k,h,m),h.onIncluded&&h.onIncluded.call(k,c.context||k)}}var d=a.meta,e=a.util.methodize,f=a.MObjectUtil.merge,g=a.MObjectUtil.eachOwn;a.MObjectUtil.clone;var h=a.MObjectUtil.trace,i=function(a){var b=d.get(a,"modules");return h(a,"__proto__",function(a){b.concat(d.get(a,"modules"))}),b},j=function(a,b,c){var e=d.get(a,"modules"),f=d.get(b,"modules")||[];f.concat([b]).forEach(function(a){-1==c.indexOf(a)&&e.push(a)})};a.$module=b,a.$include=c},Mayjs),Mayjs.$run(function(a){function b(a,b){var c,d=Object.create(a);if(Object.__proto__?c=function(){var a=c.prototype.initialize;a&&a.apply(this,arguments)}:(e.set(d,"proto",a,!0),c=function(){this.__proto__=d;var a=c.prototype.initialize;a&&a.apply(this,arguments)}),!c.extend){var f=arguments.callee;c.extend=function(a){return f(this.prototype,a)}}for(var g in b){var h=b[g];"function"==typeof h&&e.set(h,"name",g),d[g]=h}return e.set(d,"interfaces",[]),c.prototype=d,c}function c(a){return i.extend(a)}function d(a){var b=new i;return g(b,a),b}var e=a.meta,f=a.MObjectUtil.trace,g=a.MObjectUtil.mix,h=a.$interface({initialize:[],base:[],__interfaces__:Array,__modules__:Array}),i=b(Object.prototype,{initialize:function(){e.set(this,"interfaces",[]),e.set(this,"modules",[])},_callerOwner:function(a,b){var c=null;if(b){if(this.__proto__[b]==a)return this.__proto__;f(this,"__proto__",function(d){return d.hasOwnProperty(b)&&d[b]==a?(c=d,!1):void 0})}else f(this,"__proto__",function(b){Object.keys(b).forEach(function(d){return b[d]==a?(c=b,e.set(a,"name",d),!1):void 0})});return c},base:function(){var a=arguments.callee.caller,b=a.name||e.get(a,"name"),c=this._callerOwner(a,b);b||(b=e.get(a,"name"));var d=c?e.get(c,"proto"):null,f=d?d[b]:null;return"function"==typeof f?f.apply(this,arguments):void 0}});a.$implement(h,i.prototype),i.extend=function(a){var c=b(this.prototype,a);return a.initialize||(c.prototype.initialize=function(){this.base()}),c},a.$extend=b,a.Base=i,a.IBase=h,a.$class=c,a.$obj=d},Mayjs),Mayjs.$run(function(a){function b(b){b=d(b);var c=arguments.callee.findWrappersByObj(b);if(0===c.length)return b;var f={};return c.forEach(function(c){a.$include({module:c.module,to:f,option:e({context:b},c.includeOption)})}),f}function c(c){c=d(c);var e=b.findWrappersByObj(c);return 0===e.length?c:(e.forEach(function(b){a.$include({module:b.module,to:c,option:b.includeOption})}),c)}var d=a.util.toObject,e=a.MObjectUtil.merge,f=a.MObjectUtil.mix,g=a.meta;g.set(b,"map",[]),f(b,{findWrappersByType:function(a){var c=g.get(b,"map").filter(function(b){return b.type==a});return 0===c.length?[]:c[0].modules},findWrappersByPrototype:function(a){for(var c,d=[];a&&(d=d.concat(this.findWrappersByType(a)),g.has(a,"interfaces")&&g.get(a,"interfaces").forEach(function(a){d=d.concat(b.findWrappersByType(a))}),c=a,a=c.__proto__||(c.constructor?c.constructor.prototype:null),a!=c););return d},findWrappersByObj:function(a){if(null===a)return[];var c=[],d=function(a){c=c.concat(b.findWrappersByType(a))},e=typeof a;return"object"==e||"function"==e?(c=c.concat(b.findWrappersByPrototype(a.__proto__||a.constructor.prototype)),g.has(a,"interfaces")&&g.get(a,"interfaces").forEach(function(a){d(a)})):d(e),c},exists:function(a,c){return g.get(b,"map").filter(function(b){return b.type==a}).filter(function(a){return a.module==c}).length>0},regist:function(a){var b=a.wrapper,c=a.toWrap,d=a.includeOption,e=this;if((c==Function.prototype||("function"==typeof c&&(c=c.prototype),c==Function.prototype||c&&-1!=["string","object"].indexOf(typeof c)))&&"object"==typeof b){var f=g.get(e,"map"),h=f.filter(function(a){return a.type==c}),i={module:b,includeOption:d};return 0===h.length?(h={type:c,modules:[i]},f.push(h)):0===h[0].modules.filter(function(a){return a.module==b}).length&&h[0].modules.push(i),this}}}),a.$=b,a.$$=c},Mayjs),Mayjs.$run(function(a){function b(b,c){var d=b||arguments.callee.caller,f=e.get(d,"param_types");c=c||d.arguments;for(var g,h=0,i=c.length;i>h;h++){if(g=f[h].type,null===g)return!0;if(!a.$is(g,c[h]))return!1}return!0}function c(a,c){var d=c.length,f=function(a){return e.get(a,"param_types")},g=a.filter(function(a){return f(a).length>=d});if(g.length<=1)return g[0];for(var h,i=g.sort(function(a,b){return f(a).length-f(b).length});h=i.shift();)if(b(h,c))return h}function d(a,b){var d=["function"==typeof a?a:f(paramsTypes,b)],e=function(){var a=arguments,b=c(d,a);return b?b.apply(this,a):void 0};return e.overload=function(a,b){return d.push("function"==typeof a?a:f(a,b)),this},e}var e=a.meta,f=a.$def;a.$overload=d},Mayjs),Mayjs.$run(function(a){var b=a.util.fn,c=a.util.enumeration,d=a.util.methodize,e=a.util.parseParamNames,f=a.MObjectUtil.merge,g=a.MObjectUtil.mix;a.dsl={$:a.$,$$:a.$$,$check:a.$check,$class:a.$class,$clone:a.$clone,$var:a.$var,$def:a.$def,$enum:c,$fn:b,$global:a.$global,$implement:a.$implement,$interface:a.$interface,$is:a.$is,$merge:f,$mix:g,$module:a.$module,$obj:a.$obj,$run:a.$run,$support:a.$support},a.DSL=function(){return a.$var(a.dsl)},a.MFunctionWrapper=a.$module({overload:function(b,c,d){var e=a.$overload(b);return e.overload(c,d),e},paramNames:function(a){return e(a)},methodize:d});var h={meta:a.meta.get,setMeta:a.meta.set,hasMeta:a.meta.has,include:function(b,c,d){return a.$include({module:c,to:b,option:d})},overwrite:a.util.overwrite};a.$include({module:h,to:a.Base.prototype,option:{methodize:!0}}),a.$include({module:a.MObjectUtil,to:a.Base.prototype,option:{methodize:!0}}),a.MObjectWrapper={set:function(a,b,c){return a[b]=c,a},get:function(a,b){return a[b]},call:function(a,b){b=a[b];var c=util.parseArray(arguments).split(2);return b.apply(a,c)}},a.$include({module:a.MObjectUtil,to:a.MObjectWrapper}),a.$include({module:h,to:a.MObjectWrapper}),a.$.regist({wrapper:a.MObjectWrapper,toWrap:Object,includeOption:{methodize:!0}}),a.$.regist({wrapper:a.MFunctionWrapper,toWrap:Function,includeOption:{methodize:!0}})},Mayjs);