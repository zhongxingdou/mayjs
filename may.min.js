/*! mayjs 2014-09-22 */
var M=function(a){if(0==arguments.length)return M.exportDSL();if(a){var b=M.$wrapper(),c=Array.prototype.slice.call(arguments,1);return a.apply(this,[b.$,b.$$].concat(c))}};M.global=this,"undefined"!=typeof global&&(M.global=global),M.exportDSL=function(a){var b=function(){return Object.keys(M).filter(function(a){return/^\$/.test(a)&&-1==["$","$$"].indexOf(a)})};return a?(b().forEach(function(b){a[b]=M[b]}),void 0):M.util.dsl(M,b())+M.util.dsl(M.$wrapper())},"undefined"!=typeof module&&(module.exports=M),M.util={parseArguNames:function(a){var b=a.toString().match(/.*?\((.*)?\)/);return b&&b[1]?b[1].split(",").map(function(a){return a.trim()}):[]},makeMultiTargetFn:function(a){return function(){if(arguments.length<=2)return a(arguments[0],arguments[1]);for(var b=arguments[0],c=1,d=arguments.length;d>c;c++)if(a(b,arguments[c])===!1)return!1;return!0}},toObject:function(a){var b=a;switch(typeof a){case"string":b=new String(a);break;case"number":b=new Number(a);break;case"boolean":b=new Boolean(a)}return b},fn:function(){return arguments.callee.caller.apply(this,arguments)},parseArray:function(a){return Array.prototype.slice.call(a,0)},enumeration:function(a){if("object"==typeof a)return arguments[0];for(var b={},c=0,d=arguments.length;d>c;c++)b[arguments[c]]={};return b},methodize:function(a,b,c){return function(){var d=b||this;c&&(d=c(d));var e=Array.prototype.slice,f=[d].concat(e.call(arguments));return a.apply(this,f)}},overwrite:function(a,b,c){var d=a[b].bind(a);a[b]=function(){var a=[d].concat(Array.prototype.slice.call(arguments,0));return c.apply(this,a)}},dsl:function(obj,members){obj=obj||this;var tempVarName="_temp"+Date.now()+Math.random().toString().substr(2);eval(tempVarName+"={value: {}}");var temp=eval(tempVarName);temp.value=obj,"string"==typeof members&&""!==members?members=members.split(" ").map(function(a){return a.trim()}):members||(members=Object.keys(obj));var codes=members.map(function(a){return a+"="+tempVarName+".value"+"['"+a+"']"});return"var "+codes.join(",")+";delete "+tempVarName+";"},run:function(a){return 1==arguments.length?a():a.apply(this,Array.prototype.slice.call(arguments,1))}},M.$fn=M.util.fn,M.$run=M.util.run,M.$enum=M.util.enumeration,M.$overwrite=M.util.overwrite,M.$methodize=M.util.methodize,M.$dsl=M.util.dsl,M.MObjectUtil={isPrivate:function(a){return/^__/.test(a)},isProtected:function(a){return/^_(?!_)/.test(a)},isPublic:function(a){return!this.isProtected(a)&&!this.isPrivate(a)},has:function(a,b){return a&&a.hasOwnProperty(b)&&"function"!=typeof a[b]||!1},can:function(a,b){return a&&a[b]&&"function"==typeof a[b]||!1},eachAll:function(a,b){for(var c in a)if(b(c,a[c])===!1)break},eachOwn:function(a,b){for(var c in a)if(a.hasOwnProperty(c)&&this.isPublic(c)&&b(c,a[c])===!1)break},eachProp:function(a,b){this.eachOwn(a,function(a,c){return"function"!=typeof c?b(a,c):void 0})},traverseChain:function(a,b,c){for(var d=a[b];d;){if(c(d)===!1)return!1;d=d[b]}return!0},clone:function(a,b){if(!a)return a;if(-1==["object","function"].indexOf(typeof a))return a;if("function"==typeof a.clone)return a.clone(b);var c={},d=Object.prototype.toString.call(a).slice(8,-1);if("Array"===d)if(c=[],b)for(var e=0,f=a.length;f>e;e++)c.push(arguments.callee(a[e],b));else c=a.slice(0);else"Object"!==d&&(c=new a.constructor(a.valueOf()));if(b)for(var g in a){var h=a[g];c[g]=Object.prototype.isPrototypeOf(h)?arguments.callee(h,b):h}else for(var g in a)c[g]=a[g];return c},mix:function(a,b,c){if(!b)return a;var d;if(c)for(d in b)-1==c.indexOf(d)&&(a[d]=b[d]);else for(d in b)a[d]=b[d];return a},merge:function(){for(var a,b={},c=null,d=0,e=arguments.length;e>d;d++)if(c=arguments[d])for(a in c)b[a]=c[a];return b}},M.$merge=M.MObjectUtil.merge,M.$mix=M.MObjectUtil.mix,M.$clone=M.MObjectUtil.clone,M.util.run(function(a){function b(a,b){var c=[];if(e(Array,a))if(b)for(var f=0,g=b.length;g>f;f++)c.push({name:b[f],type:a[f]});else a.forEach(function(a){for(var b in a){"returns"!=b&&c.push({name:b,type:a[b]});break}});else c.push({name:b[0],type:d(a)});return c}function c(c,d){return d.__argu_types__=b(c,a.util.parseArguNames(d)),d}function d(a,b){interface_=b?Object.create(b):Object.create(h);for(var c in a)interface_[c]=a[c];return interface_}function e(a,b){if(l(a,b)||m(a,b))return!0;var c=typeof a;if("function"==c){if(a.prototype&&m(a.prototype,b))return!0}else if("object"==c)return f(a,b);return!1}function f(a,b,c){if(!c&&b.__interfaces__&&-1!=b.__interfaces__.indexOf(a))return!0;var d=/^\[(.*?)\]$/,f=/^__.*__$/;for(var g in a){var h=b[g],i=a[g],j=g.match(d);if(!(j&&(g=j[1],h=b[g],null==h)||f.test(g)||l(Array,i)||e(i,h)))return!1}return!0}function g(a,c){var d=c.__interfaces__||(c.__interfaces__=[]);if(-1==d.indexOf(a)){if(!f(a,c))throw"object did not implement given interface";Object.keys(a).forEach(function(d){e(Array,a[d])&&(c[d].__argu_types__=b(a[d]))}),d.push(a)}}var h={},i=function(a){return Object.prototype.toString.call(a)},j=a.util.makeMultiTargetFn(function(a,b){if(null==a||"undefined"==a)return null==b;var c=i(b);return"number"==a||a==Number?c==i(Number.prototype):"string"==a||a==String?c==i(String.prototype):"boolean"==a||a==Boolean?c==i(Boolean.prototype):"function"==a||a==Function?"function"==typeof b:!1}),k=a.util.makeMultiTargetFn(function(a,b){return"function"!=typeof a?!1:-1!=[Array,RegExp,Error,Date].indexOf(a)?i(a.prototype)===i(b):b instanceof a}),l=a.util.makeMultiTargetFn(function(a,b){return j(a,b)?!0:k(a,b)?!0:!1}),m=a.util.makeMultiTargetFn(function(a,b){return"object"!=typeof a?!1:null==a?!1:a.isPrototypeOf(b)}),n=a.util.makeMultiTargetFn(function(a){if(a===!1)throw"$check failed!"});a.Interface=h,a.$interface=d,a.$support=f,a.$implement=g,a.$is=l,a.$hasProto=m,a.$func=c,a.$check=n,a._is=e},M),M.util.run(function(a){function b(a){return a}function c(b,c,d){var e={methodize:!1,context:null,methodizeTo:null};d=a.MObjectUtil.merge(e,c.__option__,d);var f=d.methodize;a.MObjectUtil.eachOwn(c,function(c,e){"init"===c||"onIncluded"===c||c.match(/^__.*__$/)||(b[c]=f&&"function"==typeof e?a.util.methodize(e,d.context,d.methodizeTo):e)}),c.__interfaces__&&c.__interfaces__.forEach(function(c){a.$implement(c,b)}),c.onIncluded&&c.onIncluded.call(b,d.context||b)}var d={"[context]":Object,"[methdize]":Boolean,"[methdizeTo]":[Object]},e={"[__option__]":d,"[__supports__]":Array,"[init]":Function,"[onIncluded]":Function};a.$module=b,a.$include=c,a.IModule=e},M),M.util.run(function(a){function b(){}function c(a){return g.extend(a)}function d(a){return f.extend(a)}var e=a.MObjectUtil.traverseChain;a.MObjectUtil.mix;var f={__interfaces__:[],initialize:function(){},extend:function(a){var b=Object.create(this);Object.__proto__||(b.__proto__=this);for(var c in a){var d=a[c];b[c]=d,"function"==typeof d&&(d.__name__=c)}return this.initialize.call(b),b},base:function(){var a=arguments.callee.caller,b=a.name||a.__name__,c=this.__getCallerOwner(a,b);b||(b=a.__name__);var d=c?c.__proto__:null,e=d?d[b]:null;return"function"==typeof e?e.apply(this,arguments):void 0},__getCallerOwner:function(a,b){var c=null;if(b){if(this.hasOwnProperty(b)&&this[b]===a)return this;if(this.__proto__[b]==a)return this.__proto__;e(this,"__proto__",function(d){return d.hasOwnProperty(b)&&d[b]==a?(c=d,!1):void 0})}else{for(var d in this)if(this[d]===a){c=this,a.__name__=d;break}if(c)return c;e(this,"__proto__",function(b){Object.keys(b).forEach(function(d){return b[d]==a?(c=b,a.__name__=d,!1):void 0})})}return c}};b.prototype=f.extend({initialize:function(){this.__interfaces__=[],this.base()}}),b.extend=function(a){var c=this.prototype.extend(a);c.hasOwnProperty("initialize")||(c.initialize=function(){this.base.apply(this,arguments)});var d;d=Object.__proto__?function(){return c.isPrototypeOf(this)?(this.constructor=d,c.initialize.apply(this,arguments),void 0):new arguments.callee}:function(){return c.isPrototypeOf(this)?(this.constructor=d,this.__proto__=c,c.initialize.apply(this,arguments),void 0):new arguments.callee},c.constructor=this,d.prototype=c;var e=["prototype"];for(var f in b)-1==e.indexOf(f)&&(d[f]=this[f]);return d};var g=b.extend({}),h=a.$interface({initialize:[],base:[],__interfaces__:Array});a.$implement(h,f),a.IBase=h,a.BaseObj=f,a.BaseClass=g,a.$class=c,a.$obj=d},M),M.util.run(function(a){var b=a.util.toObject,c=a.MObjectUtil.merge;a.MObjectUtil.mix;var d=a.$class({initialize:function(){this.__map__=[],this.__DSL__={$:this.$.bind(this),$$:this.$$.bind(this)},this.__DSL__.$.reg=this.$reg.bind(this),this.__DSL__.$.clear=this.$clear.bind(this)},__wrap:function(d,e,f){d=b(d),e||(e=d);var g=this.__findWrappersByObj(d);return 0===g.length?d:(g.forEach(function(b){var d=c(f||{},b.includeOption);a.$include(e,b.module,d)}),e)},$clear:function(){this.__map__=[]},$:function(a){return this.__wrap(a,{},{context:a})},$$:function(a){return this.__wrap(a)},$reg:function(a,b,c){for(var d=c||a.__option__||{},e=b?Array.prototype.isPrototypeOf(b)?b:[b]:a.__supports__,f=0,g=e.length;g>f;f++){var h=e[f];if(h!=Function.prototype&&("function"==typeof h&&(h=h.prototype),h!=Function.prototype&&(!h||-1==["string","object"].indexOf(typeof h))))return;if("object"!=typeof a)return;var i=this.__map__,j=i.filter(function(a){return a.type==h}),k={module:a,includeOption:d};0===j.length?(j={type:h,modules:[k]},i.push(j)):0===j[0].modules.filter(function(b){return b.module==a}).length&&j[0].modules.push(k)}return this},__findWrappersByType:function(a){var b=this.__map__.filter(function(b){return b.type==a});return 0===b.length?[]:b[0].modules},findWrappersByType:function(a){return this!=e?e.__findWrappersByType(a).concat(this.__findWrappersByType(a)):this.__findWrappersByType(a)},__findWrappersByPrototype:function(a){for(var b,c=this,d=[];a&&(d=d.concat(c.findWrappersByType(a)),a.hasOwnProperty("__interfaces__")&&a.__interfaces__.forEach(function(a){d=d.concat(c.findWrappersByType(a))}),b=a,a=b.__proto__||(b.constructor?b.constructor.prototype:null),a!=b););return d},__findWrappersByObj:function(a){if(null===a)return[];var b=[],c=this,d=function(a){b=b.concat(c.findWrappersByType(a))},e=typeof a;return("object"==e||"function"==e)&&(b=b.concat(this.__findWrappersByPrototype(a.__proto__||a.constructor.prototype)),a.hasOwnProperty("__interfaces__")&&a.__interfaces__.forEach(function(a){d(a)})),b}});a.$wrapper=function(){return(new d).__DSL__};var e=new d;a.MObjectUtil.mix(a,e.__DSL__),a.Wrapper=d},M),M.util.run(function(a){function b(b,c){var d=b||arguments.callee.caller,e=d.__argu_types__;c=c||d.arguments;for(var f,g=0,h=c.length;h>g;g++){if(f=e[g].type,null===f)return!0;if(!a._is(f,c[g]))return!1}return!0}function c(a,c){var d=c.length,e=a.filter(function(a){return a.__argu_types__.length>=d});if(0==e.length)return null;for(var f;f=e.shift();)if(b(f,c))return f}function d(a,b){var d={};d.value=["function"==typeof a?a:e(a,b)];var f=function(){var a=arguments,b=c(d.value,a);return b?b.apply(this,a):void 0};return f.overload=function(a,b){return d.value.push("function"==typeof a?a:e(a,b)),d.value=d.value.sort(function(a,b){return a.__argu_types__.length-b.__argu_types__.length}),this},f}var e=a.$func;a.$overload=d},M);